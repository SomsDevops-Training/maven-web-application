pipeline{
    agent any
    //declared tools here that we installed as plugin
    tools{
        maven "maven3.8.4"
    }
    options {
  timestamps()
}
    //All stages starts from here
    stages{
                //Running checkout code for git
        stage('checkoutcode'){
                        steps{
                            slackSendnotification('STARTED')
                git branch: 'developement', credentialsId: '8dd1ef96-f9f1-4823-9a66-7b56decc81fb', url: 'https://github.com/SomsDevops-Training/maven-web-application.git'
            }
        }
        
        //Running Build for code
        stage('build'){
            steps{
                sh "mvn clean package"
            }
        }
        
        //Running SonarQube Report
        stage('ExecuteSonarQube'){
            steps{
               sh "mvn sonar:sonar"
            }
        }
        
        //Uploading artifacts into artifact repository
        stage('Uploadartifactory'){
            steps{
               sh "mvn deploy"
            }
        }
        stage(deploytoTomcat){
            steps{
                //sshagent(['a5966214-2c05-40c5-ba71-1d6086452535']) {
                sh "sshpass -p '112233' scp -o StrictHostKeyChecking=no /var/lib/jenkins/workspace/pipeline-scriptedway/target/maven-web-application.war root@192.168.29.80:/root/apache-tomcat-9.0.71/webapps"
                
            }
        }
    }
    post {
    success {
      slackSendnotification('SUCCESSFUL')
    }
    failure {
      slackSendnotification('FAILURE')
    }
  }
}
def slackSendnotification(String buildStatus = 'STARTED') {
  // build status of null means successful
  buildStatus =  buildStatus ?: 'SUCCESSFUL'

  // Default values
  def colorName = 'RED'
  def colorCode = '#FF0000'
  def subject = "${buildStatus}: Job '${env.JOB_NAME} [${env.BUILD_NUMBER}]'"
  def summary = "${subject} (${env.BUILD_URL})"

  // Override default values based on build status
  if (buildStatus == 'STARTED') {
    color = 'YELLOW'
    colorCode = '#FFFF00'
  } else if (buildStatus == 'SUCCESSFUL') {
    color = 'GREEN'
    colorCode = '#00FF00'
  } else {
    color = 'RED'
    colorCode = '#FF0000'
  }

  // Send notifications
  slackSend (color: colorCode, message: summary, channel: '#walmart')
}
